# ============================================================
# Azure DevOps Pipeline â€“ Selenium Automation
# Author: Sana Ansari
#
# Purpose:
# - Run Selenium TestNG automation
# - Generate Extent HTML report
# - Capture screenshots (Base64)
# - Publish reports as pipeline artifacts
# ============================================================

trigger:
  - main

pool:
  name: Default   # Self-hosted agent (your laptop)

steps:

  # ------------------------------------------------------------
  # STEP 1: Verify Java
  # ------------------------------------------------------------
  - script: |
      echo JAVA_HOME=%JAVA_HOME%
      where java
      java -version
    displayName: 'Verify Java Version'

  # ------------------------------------------------------------
  # STEP 2: Verify Maven
  # ------------------------------------------------------------
  - script: |
      where mvn
      mvn -version
    displayName: 'Verify Maven Version'

  # ------------------------------------------------------------
  # STEP 3: Create required folders (IMPORTANT)
  # ------------------------------------------------------------
  - script: |
      echo Creating required folders...
      mkdir reports
      mkdir screenshots
    displayName: 'Prepare Report Directories'

  # ------------------------------------------------------------
  # STEP 4: Build & Run Selenium Tests
  # ------------------------------------------------------------
  - script: |
      mvn clean test
    displayName: 'Build & Run Selenium Tests'

  # ------------------------------------------------------------
  # STEP 5: Publish JUnit Results (Azure UI)
  # ------------------------------------------------------------
  - task: PublishTestResults@2
    condition: succeededOrFailed()
    displayName: 'Publish Test Results'
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/surefire-reports/TEST-*.xml'

  # ------------------------------------------------------------
  # STEP 6: Publish Extent Report + Test Outputs
  # ------------------------------------------------------------
  - task: PublishBuildArtifacts@1
    condition: succeededOrFailed()
    displayName: 'Publish Automation Reports'
    inputs:
      PathtoPublish: |
        reports
        screenshots
        target/surefire-reports
      ArtifactName: 'automation-test-reports'
      publishLocation: 'Container'